<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.chord path {
  fill-opacity: .67;
  stroke: #000;
  stroke-width: .5px;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var svg;

d3.csv("scores.csv", function(data) {
   var length = 0;

   data.forEach(function(d) {
      if (length < +d.i) {
         length = +d.i;
      }
      if (length < +d.j) {
         length = +d.j;
      }
   });
   length = length+1;
   console.log(length);
   
   var dist = new Array(length);
   for(var i=0 ; i < length; i++){
      dist[i] = new Array(length);
   };
   
   data.forEach(function(d) {
      var i = +d.i;
      var j = +d.j;
      if(i < length && j < length){
         dist[i][j] = +d.score;
      }
   });
   console.log(dist[0][0]);
   console.log(dist[0].toString());

   var chord = d3.layout.chord()
       .padding(.05)
       .sortSubgroups(d3.descending)
       .matrix(dist);
   
   var width = 900,
       height = 900,
       innerRadius = Math.min(width, height) * .41,
       outerRadius = innerRadius * 1.05;
   
   var fill = d3.scale.ordinal()
       .domain(d3.range(4))
       .range(["#000000", "#FFDD89", "#957244", "#F26223"]);
   
   svg = d3.select("body").append("svg")
       .attr("width", width)
       .attr("height", height)
        .append("g")
       .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
   
   var gps = svg.selectAll("g.group").data(chord.groups)
         .enter()
         .append("svg:g")
         .attr("class","group");   

   gps.append("svg:text")
         .attr("x", 100)
         .attr("dy",15)
         .append("svg:textPath")
         .text(function(d) { return "a"; });

   svg.append("g").selectAll("path")
       .data(chord.groups)
     .enter().append("path")
       .style("fill", function(d) { return fill(d.index); })
       .style("stroke", function(d) { return fill(d.index); })
       .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius))
       .on("mouseover", fade(.1))
       .on("mouseout", fade(1));
   
   svg.append("g")
       .attr("class", "chord")
     .selectAll("path")
       .data(chord.chords)
     .enter().append("path")
       .attr("d", d3.svg.chord().radius(innerRadius))
       .style("fill", function(d) { return fill(d.target.index); })
       .style("opacity", 1);

   //svg.selectAll("g.group").append("svg:textPath").text(function(d) { return "a";}); 
});


// Returns an event handler for fading a given chord group.
function fade(opacity) {
  return function(g, i) {
    svg.selectAll(".chord path")
        .filter(function(d) { return d.source.index != i && d.target.index != i; })
      .transition()
        .style("opacity", opacity);
  };
}

</script>

